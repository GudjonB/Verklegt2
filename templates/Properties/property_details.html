{% extends "base.html" %}
{% block content %}
    {% load humanize %}
    <h2>{{ Property.address }}</h2>

    <div id="demo" class="carousel slide" data-ride="carousel">
        <!-- Indicators -->
        <ul class="carousel-indicators">
            {% for i in Property.propertyimages_set.all %}
                {% if forloop.first %}
                    <li data-target="#demo" data-slide-to="{{ forloop.counter0 }}" class="active"></li>
                {% else %}
                    <li data-target="#demo" data-slide-to="{{ forloop.counter0 }}"></li>
                {% endif %}

            {% endfor %}
        </ul>
        <div class="carousel-inner">
            {% if Property.propertyimages_set.count != 0 %}
                {% for img in Property.propertyimages_set.all %}
                    {% if forloop.first %}
                        <div class="carousel-item active">
                            <img src="{{ img }}" alt="..." >
                        </div>
                    {% else %}
                        <div class="carousel-item">
                            <img src="{{ img }}" alt="..." >
                        </div>
                    {% endif %}
                {% endfor %}
            {% else %}
                <div class="carousel-item active">
                    <img src="/static/images/Properties/default_castle.jpg" alt="..." >
                </div>
            {% endif %}
        </div>
        <!-- Left and right controls -->
        <a class="carousel-control-prev" href="#demo" data-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </a>
        <a class="carousel-control-next" href="#demo" data-slide="next">
            <span class="carousel-control-next-icon"></span>
        </a>
    </div>
    {% if user.is_authenticated and Property.id in UsersProperties %}
        <p><a href="/properties/imagesedit/{{ Property.id}}" class="btn btn-danger">Edit Pictures</a></p>
    {% endif %}

    <p><b>Price:</b> {{ Property.price|intcomma }}</p>

    <p><b>Total Visits:</b> {{ PropertyVisits.count }}</p>
    


    {% if user.is_authenticated %}
        {% if Property in Favourites %}
            <img id="fav-img" src="/static/images/favorites_star_yellow.png"></br>
            <a class="btn-favorites" href="/users/removeFavourite/{{ Property.id}}" >Remove from favourites</a>
        {% else %}
            <img id="fav-img" src="/static/images/favorites_star.png"></br>
            <a class="btn-favorites" href="/users/addFavourite/{{ Property.id}}" >Add to favourites</a>
        {% endif %}
        <br><br>
        {% if Property in Cart %}
            <a href="/users/removeCartItem/{{ Property.id }}" class="card-link">Remove from cart</a>
        {% else %}
            <a href="/users/addCartItem/{{ Property.id }}" class="card-link">Add to cart</a>
        {% endif %}
    {% else %}
        <a href="../users/login" class="card-link">Add to cart</a>
    {% endif %}

    <h3>Property Details</h3>
    <p><div id="descr">{{ Property.description_set.first.description }}</div></p>
    <p><b>Category:</b> {{ Property.category.category}}</p>
    <p><b>City:</b> {{ Property.zip.city }}</p>
    <p><b>Zip:</b> {{ Property.zip.zip }}</p>
    <p><b>Square meters:</b> {{ Property.size|intcomma }}</p>
    <p><b>Bathrooms:</b> {{ Property.bathrooms }}</p>
    <p><b>Rooms:</b> {{ Property.rooms }}</p>
    {% if Property.category_id != 6 %}
        <p><b>Year built:</b> {{ Property.year_built }}</p>
    {% endif %}
    {% if user.is_authenticated and Property.id in UsersProperties %}
        <a href="/properties/delete/{{ Property.id}}" class="btn btn-danger">Delete Property</a>
        <a href="/properties/update/{{ Property.id}}" class="btn btn-danger">Edit Property Info</a>
    {% endif %}
{% endblock %}